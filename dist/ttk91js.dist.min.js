"use strict";var ttk91js=function(t){function e(t,e,r,s,i){var n=i;return n|=t<<24,n|=e<<21,n|=r<<19,n|=s<<16}function r(t){for(var e=t.split("\n"),r=[],s={},n=[],o=[],a=0;a<e.length;a++){var h=e[a].trim(),u=h.indexOf(";");if(u!=-1&&(h=h.substring(0,u)),0!==h.length){var c=h.split(/[\s]+/);if(i.indexOf(c[0])==-1&&(n.push(c[0]),o.push(r.length),c.shift()),"DC"==c[0])o.pop(),o.push(parseInt(c[1]));else{if(3==c.length&&(","!=c[1][c[1].length-1]?console.log("ERROR1"):c[1]=c[1].substring(0,c[1].length-1)),3==c.length)if(u=c[2].indexOf("("),u!=-1){var l=c[2].indexOf(")",u);l==-1?console.log("ERROR2"):(c.push(c[2].substring(u+1,l)),c[2]=c[2].substring(0,u))}else"="==c[2][0]?c.push("R0"):"@"==c[2][0]?"R"==c[2][1]?(c.push("R"+c[2][2]),c[2]="0"):c.push("R0"):"R"==c[2][0]?(c.push(c[2]),c[2]="=0"):c.push("R0");s[r.length]=a,r.push(c)}}}return{code:r,symbols:n,data:o,lineMap:s}}var s={NOP:0,STORE:1,LOAD:2,IN:3,OUT:4,ADD:17,SUB:18,MUL:19,DIV:20,MOD:21,AND:22,OR:23,XOR:24,SHL:25,SHR:26,NOT:27,SHRA:28,COMP:31,JUMP:32,JNEG:33,JZER:34,JPOS:35,JNNEG:36,JNZER:37,JNPOS:38,JLES:39,JEQU:40,JGRE:41,JNLES:42,JNEQU:43,JNGRE:44,CALL:49,EXIT:50,PUSH:51,POP:52,PUSHR:53,POPR:54,SVC:112},i=Object.keys(s),n={CRT:0},o={HALT:11},a={IMMEDIATE:0,DIRECT:1,INDIRECT:2},h=6;t.compile=function(t){function i(t){for(var e=0;e<l.symbols.length;e++)if(l.symbols[e]==t)return l.code.length+e;console.log("ERROR3")}function u(t){return"SP"==t||2==t.length&&"R"==t[0]}function c(t){return"SP"==t?h:parseInt(t[1])}var l=r(t),g=[],R=!0,f=!1,m=void 0;try{for(var E,y=l.code[Symbol.iterator]();!(R=(E=y.next()).done);R=!0){var P=E.value;u(P[1])?P[1]=c(P[1]):P[1]=i(P[1]);var S=s[P[0]],d=P[1],J=0,O=a.DIRECT,b=0;if(P.length>2){if("="==P[2][0]){O=a.IMMEDIATE;var p=P[2].substring(1);if(/^[0-9]+$/i.test(p))b=parseInt(p);else switch(p){case"CRT":b=n.CRT;break;case"HALT":b=o.HALT}}else"@"==P[2][0]?(O=a.INDIRECT,b=parseInt(P[2].substring(1))):b=/^[a-z]+$/i.test(P[2])?i(P[2]):parseInt(P[2]);J=c(P[3])}S>=s.JUMP&&S<=s.JNGRE&&(b=d,d=0,O=0);var N=e(S,d,O,J,b);g.push(N)}}catch(t){f=!0,m=t}finally{try{!R&&y.return&&y.return()}finally{if(f)throw m}}return{lines:l.code,code:g,symbols:l.symbols,data:l.data,lineMap:l.lineMap}};return t}(ttk91js||{});"undefined"!=typeof module&&"exports"in module&&(module.exports=ttk91js);var _slicedToArray=function(){function t(t,e){var r=[],s=!0,i=!1,n=void 0;try{for(var o,a=t[Symbol.iterator]();!(s=(o=a.next()).done)&&(r.push(o.value),!e||r.length!==e);s=!0);}catch(t){i=!0,n=t}finally{try{!s&&a.return&&a.return()}finally{if(i)throw n}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ttk91js=function(t){function e(t){return[(t&255<<24)>>24,(t&7<<21)>>21,(t&3<<19)>>19,(t&7<<16)>>16,65535&t]}function r(t){this.settings=t,this.memory=new Uint32Array(t.memory),this.stdout=function(t){console.log(t)},this.lastPosition=0,this.reset()}var s=require("microevent"),i={NOP:0,STORE:1,LOAD:2,IN:3,OUT:4,ADD:17,SUB:18,MUL:19,DIV:20,MOD:21,AND:22,OR:23,XOR:24,SHL:25,SHR:26,NOT:27,SHRA:28,COMP:31,JUMP:32,JNEG:33,JZER:34,JPOS:35,JNNEG:36,JNZER:37,JNPOS:38,JLES:39,JEQU:40,JGRE:41,JNLES:42,JNEQU:43,JNGRE:44,CALL:49,EXIT:50,PUSH:51,POP:52,PUSHR:53,POPR:54,SVC:112},n={CRT:0},o={HALT:11},a=4,h=2,u=1,c=6,l=7;return r.prototype={_getValue:function(t,e,r){var s=0;return s=0===e?r:this.reg[e]+r,t>0&&(s=this._getValue(--t,e,this.memory[r])),s},load:function(t){for(var e=0;e<t.code.length;e++)this.memory[e]=t.code[e];for(var r=0;r<t.symbols.length;r++)this.memory[e+r]=t.data[r];this.data=t},getRegister:function(){return{0:this.reg[0],1:this.reg[1],2:this.reg[2],3:this.reg[3],4:this.reg[4],5:this.reg[5],SP:this.reg[c],FP:this.reg[l],PC:this.reg.PC}},getMemory:function(){return this.memory},getRealLine:function(){return this.data.lineMap[this.lastPosition]},stop:function(){this.ok=!1},setStdout:function(t){this.stdout=t},reset:function(){this.ok=!0,this.SR=0,this.reg={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,FP:0,PC:0},this.memory.fill(0)},run:function(){for(var t=0;this.isRunning()&&t<100;)this.runWord(),t++},isRunning:function(){return this.ok&&this.reg.PC<this.memory.length},runWord:function(t){t=t||1;for(var e=0;e<t;e++)this._runWord()},_runWord:function(){var t=e(this.memory[this.reg.PC]),r=_slicedToArray(t,5),s=r[0],c=r[1],l=r[2],g=r[3],R=r[4],f=this._getValue(l,g,R);switch(this.lastPosition=this.reg.PC,this.reg.PC++,s){case i.STORE:var m=this.memory[R];this.memory[R]=this.reg[c],this.settings.triggerMemoryChange&&m!=this.memory[R]&&this.trigger("memory-change",R,m,this.memory[R]);break;case i.LOAD:this.reg[c]=f;break;case i.OUT:switch(R){case n.CRT:this.stdout(this.reg[c])}break;case i.ADD:this.reg[c]+=f;break;case i.SUB:this.reg[c]-=f;break;case i.DIV:this.reg[c]=Math.floor(this.reg[c]/f);break;case i.MUL:this.reg[c]*=f;break;case i.SVC:switch(R){case o.HALT:this.ok=!1}break;case i.COMP:this.SR=0,this.reg[c]==f&&(this.SR|=h),this.reg[c]>f&&(this.SR|=u),this.reg[c]<f&&(this.SR|=a);break;case i.JUMP:this.reg.PC=this.memory[R];break;case i.JNEG:break;case i.JZER:break;case i.JPOS:break;case i.JNNEG:break;case i.JNZER:break;case i.JNPOS:break;case i.JLES:break;case i.JEQU:this.SR&h&&(this.reg.PC=this.memory[R]);break;case i.JGRE:break;case i.JNLES:break;case i.JNEQU:this.SR&h||(this.reg.PC=this.memory[R]);break;case i.JNGRE:}}},s.mixin(r),t.Machine=r,t}(ttk91js||{});"undefined"!=typeof module&&"exports"in module&&(module.exports=ttk91js);