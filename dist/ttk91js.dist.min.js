"use strict";var _slicedToArray=function(){function e(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw s}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function e(t,r,n){function i(o,u){if(!r[o]){if(!t[o]){var c="function"==typeof require&&require;if(!u&&c)return c(o,!0);if(s)return s(o,!0);var a=new Error("Cannot find module '"+o+"'");throw a.code="MODULE_NOT_FOUND",a}var f=r[o]={exports:{}};t[o][0].call(f.exports,function(e){var r=t[o][1][e];return i(r?r:e)},f,f.exports,e,t,r,n)}return r[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){var n=function(){};n.prototype={bind:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},unbind:function(e,t){this._events=this._events||{},e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(t),1)},trigger:function(e){if(this._events=this._events||{},e in this._events!=!1)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},n.mixin=function(e){for(var t=["bind","unbind","trigger"],r=0;r<t.length;r++)e.prototype[t[r]]=n.prototype[t[r]]},"undefined"!=typeof t&&"exports"in t&&(t.exports=n)},{}],2:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(h===clearTimeout)return clearTimeout(e);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function u(){m&&g&&(m=!1,g.length?y=g.concat(y):d=-1,y.length&&c())}function c(){if(!m){var e=s(u);m=!0;for(var t=y.length;t;){for(g=y,y=[];++d<t;)g&&g[d].run();d=-1,t=y.length}g=null,m=!1,o(e)}}function a(e,t){this.fun=e,this.array=t}function f(){}var l,h,p=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(e){h=i}}();var g,y=[],m=!1,d=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];y.push(new a(e,t)),1!==y.length||m||s(c)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=f,p.addListener=f,p.once=f,p.off=f,p.removeListener=f,p.removeAllListeners=f,p.emit=f,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],3:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],4:[function(e,t,r){t.exports=function(e){return e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],5:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:o};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(t)?n.showHidden=t:t&&r._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=s),c(n,e,n.depth)}function s(e,t){var r=i.styles[t];return r?"["+i.colors[r][0]+"m"+e+"["+i.colors[r][1]+"m":e}function o(e,t){return e}function u(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function c(e,t,n){if(e.customInspect&&t&&S(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return v(i)||(i=c(e,i,n)),i}var s=a(e,t);if(s)return s;var o=Object.keys(t),y=u(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),R(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return f(t);if(0===o.length){if(S(t)){var m=t.name?": "+t.name:"";return e.stylize("[Function"+m+"]","special")}if(O(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(k(t))return e.stylize(Date.prototype.toString.call(t),"date");if(R(t))return f(t)}var d="",b=!1,j=["{","}"];if(g(t)&&(b=!0,j=["[","]"]),S(t)){var w=t.name?": "+t.name:"";d=" [Function"+w+"]"}if(O(t)&&(d=" "+RegExp.prototype.toString.call(t)),k(t)&&(d=" "+Date.prototype.toUTCString.call(t)),R(t)&&(d=" "+f(t)),0===o.length&&(!b||0==t.length))return j[0]+d+j[1];if(n<0)return O(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var E;return E=b?l(e,t,n,y,o):o.map(function(r){return h(e,t,n,y,r,b)}),e.seen.pop(),p(E,d,j)}function a(e,t){if(w(t))return e.stylize("undefined","undefined");if(v(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return b(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function l(e,t,r,n,i){for(var s=[],o=0,u=t.length;o<u;++o)P(t,String(o))?s.push(h(e,t,r,n,String(o),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(h(e,t,r,n,i,!0))}),s}function h(e,t,r,n,i,s){var o,u,a;if(a=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},a.get?u=a.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):a.set&&(u=e.stylize("[Setter]","special")),P(n,i)||(o="["+i+"]"),u||(e.seen.indexOf(a.value)<0?(u=m(r)?c(e,a.value,null):c(e,a.value,r-1),u.indexOf("\n")>-1&&(u=s?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),w(o)){if(s&&i.match(/^\d+$/))return u;o=JSON.stringify(""+i),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+u}function p(e,t,r){var n=0,i=e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function g(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function m(e){return null===e}function d(e){return null==e}function b(e){return"number"==typeof e}function v(e){return"string"==typeof e}function j(e){return"symbol"===("undefined"==typeof e?"undefined":_typeof(e))}function w(e){return void 0===e}function O(e){return E(e)&&"[object RegExp]"===x(e)}function E(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))&&null!==e}function k(e){return E(e)&&"[object Date]"===x(e)}function R(e){return E(e)&&("[object Error]"===x(e)||e instanceof Error)}function S(e){return"function"==typeof e}function T(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===("undefined"==typeof e?"undefined":_typeof(e))||"undefined"==typeof e}function x(e){return Object.prototype.toString.call(e)}function D(e){return e<10?"0"+e.toString(10):e.toString(10)}function N(){var e=new Date,t=[D(e.getHours()),D(e.getMinutes()),D(e.getSeconds())].join(":");return[e.getDate(),M[e.getMonth()],t].join(" ")}function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var A=/%[sdj%]/g;r.format=function(e){if(!v(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(i(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,s=n.length,o=String(e).replace(A,function(e){if("%%"===e)return"%";if(r>=s)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),u=n[r];r<s;u=n[++r])o+=m(u)||!E(u)?" "+u:" "+i(u);return o},r.deprecate=function(e,i){function s(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}if(w(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(t.noDeprecation===!0)return e;var o=!1;return s};var I,_={};r.debuglog=function(e){if(w(I)&&(I=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!_[e])if(new RegExp("\\b"+e+"\\b","i").test(I)){var n=t.pid;_[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else _[e]=function(){};return _[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=g,r.isBoolean=y,r.isNull=m,r.isNullOrUndefined=d,r.isNumber=b,r.isString=v,r.isSymbol=j,r.isUndefined=w,r.isRegExp=O,r.isObject=E,r.isDate=k,r.isError=R,r.isFunction=S,r.isPrimitive=T,r.isBuffer=e("./support/isBuffer");var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",N(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!E(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":4,_process:2,inherits:3}],6:[function(e,t,r){function n(e){return[(e&255<<24)>>24,(e&7<<21)>>21,(e&3<<19)>>19,(e&7<<16)>>16,65535&e]}t.exports={splitWord:n,OP:Object.freeze({NOP:0,STORE:1,LOAD:2,IN:3,OUT:4,ADD:17,SUB:18,MUL:19,DIV:20,MOD:21,AND:22,OR:23,XOR:24,SHL:25,SHR:26,NOT:27,SHRA:28,COMP:31,JUMP:32,JNEG:33,JZER:34,JPOS:35,JNNEG:36,JNZER:37,JNPOS:38,JLES:39,JEQU:40,JGRE:41,JNLES:42,JNEQU:43,JNGRE:44,CALL:49,EXIT:50,PUSH:51,POP:52,PUSHR:53,POPR:54,SVC:112}),MODE:Object.freeze({IMMEDIATE:0,DIRECT:1,INDIRECT:2}),SR_BITS:Object.freeze({G:1,E:2,L:4,OVERFLOW:8,DIVIDE_BY_ZERO:16,UNKNOWN_INSTRUCTION:32,FORBIDDED_MEMORY_ADRESS:64,DEVICE_INTERRUPT:128,SVC:256,PRIVILEGED:512,INTERRUPTS_DISABLED:1024})}},{}],7:[function(e,t,r){function n(e,t,r,n,i){var s=i;return s|=e<<24,s|=t<<21,s|=r<<19,s|=n<<16}function i(e){return e=f.OP[e],e===f.OP.NOP?0:e==f.OP.NOT?1:e>=f.OP.JUMP&&e<=f.OP.JNGRE?1:3}function s(e){return 2==e.length&&(e=e.toUpperCase(),"SP"==e||"FP"==e||"R"==e[0]&&/[0-9]/.test(e[1]))}function o(e){return"="!=e[0]&&"@"!=e[0]||(e=e.substring(1)),/^[a-z][0-9a-z]*$/i.test(e)}function u(e){return"="!=e[0]&&"@"!=e[0]||(e=e.substring(1)),/^[0-9]+$/.test(e)}function c(e){return o(e)||s(e)||u(e)}function a(e){function t(e){return"="!=e[0]&&"@"!=e[0]||(e=e.substring(1)),e}function r(e){var t=!0,r=!1,n=void 0;try{for(var i,s=a[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var o=i.value;if(o.name==e)return!0}}catch(e){r=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw n}}switch(e.toUpperCase()){case"CRT":case"HALT":return!0}return!1}for(var n=e.split("\n"),s=[],u=[],a=[],f=[],p=0,g=function(e){var t=n[e].trim(),r=t.indexOf(";");if(r!=-1&&(t=t.substring(0,r)),0===t.length)return"continue";t=t.replace(/\s+/g," "),r=t.indexOf(" ");var o=null;if(o=r==-1?[t.trim()]:[t.substring(0,r),t.substring(r+1)],h.indexOf(o[0].toUpperCase())==-1){if(1==o.length)throw new l("unknown opcode ("+o[0]+")",e);a.push({name:o[0],value:s.length,type:"absolute",size:1}),r=o[1].indexOf(" "),r!=-1&&(o=[o[1].substring(0,r),o[1].substring(r+1)])}o[0]=o[0].toUpperCase();var g=void 0,y=void 0;switch(o[0]){case"EQU":g=parseInt(o[1]),y=a.pop().name,a.push({name:y,value:g,type:"absolute",size:0});break;case"DC":g=parseInt(o[1]),y=a.pop().name,a.push({name:y,value:p,type:"relative",size:1}),f.push({value:g,size:1}),p+=1;break;case"DS":var m=parseInt(o[1]);y=a.pop().name,a.push({name:y,value:p,type:"relative",size:m}),f.push({value:0,size:m}),p+=m;break;default:var d=o.shift(),b=[];if(o.length>0&&(b=o.join("").split(",").map(function(e){return e.trim()})),h.indexOf(d)==-1)throw new l("unknown opcode ("+d+")",e);if(2==b.length)if(r=b[1].indexOf("("),r!=-1){var v=b[1].indexOf(")",r);if(v==-1)throw new l("syntax error",e);b.push(b[1].substring(r+1,v)),b[1]=b[1].substring(0,r)}else b[1].length>0&&("="==b[1][0]?b.push("R0"):"@"==b[1][0]?"R"==b[1][1].toUpperCase()?(b.push("R"+b[1][2]),b[1]="0"):b.push("R0"):"R"==b[1][0].toUpperCase()?(b.push(b[1]),b[1]="=0"):b.push("R0"));if(b.forEach(function(r){if(!c(r))throw new l("syntax error ("+t+")",e)}),b.forEach(function(t){if(2==t.length&&"R"==t[0].toUpperCase()&&(/0-9/.test(t[1])||parseInt(t[1])>7))throw new l("invalid register ("+t+")",e)}),i(d)!=b.length)throw new l("wrong argcount ("+d+")",e);u.push(e),s.push({line:e,code:[d].concat(b)})}},y=0;y<n.length;y++){g(y)}var m=!0,d=!1,b=void 0;try{for(var v,j=s[Symbol.iterator]();!(m=(v=j.next()).done);m=!0){var w=v.value;if(2==w.code.length&&o(w.code[1])){var O=t(w.code[1]);if(!r(O))throw new l("unknown symbol ("+O+")",w.line)}else if(4==w.code.length&&o(w.code[2])){var E=t(w.code[2]);if(!r(E))throw new l("unknown symbol ("+E+")",w.line)}}}catch(e){d=!0,b=e}finally{try{!m&&j.return&&j.return()}finally{if(d)throw b}}return{code:s,symbols:a,data:f,sourceMap:u}}var f=e("./ttk91js.common.js"),l=e("./ttk91js.exceptions.js").Ttk91jsCompileException,h=(e("./ttk91js.debugger.js"),Object.keys(f.OP)),p={CRT:0},g={HALT:11},y=f.MODE,m=6,d=function(e){function t(e){for(var t=0;t<i.symbols.length;t++)if(i.symbols[t].name==e)return i.symbols[t].value}function r(e){return"SP"==e?m:parseInt(e[1])}for(var i=a(e),o=[],u=0;u<i.symbols.length;u++)"relative"==i.symbols[u].type&&(i.symbols[u].value+=i.code.length),delete i.symbols[u].type;var c=!0,l=!1,h=void 0;try{for(var d,b=i.code[Symbol.iterator]();!(c=(d=b.next()).done);c=!0){var v=d.value,j=v.code,w=f.OP[j[0]],O=0,E=0,k=y.DIRECT,R=0;if(j.length>1&&(O=s(j[1])?r(j[1]):t(j[1])),j.length>2)if(E=r(j[3]),0!==E&&(k=y.IMMEDIATE),w==f.OP.STORE&&(k=y.IMMEDIATE),"="==j[2][0]){k=y.IMMEDIATE;var S=j[2].substring(1);if(/^[0-9]+$/i.test(S))R=parseInt(S);else switch(S){case"CRT":R=p.CRT;break;case"HALT":R=g.HALT;break;default:R=t(S)}}else if("@"==j[2][0]){k=y.INDIRECT;var T=j[2].substring(1);R=t(T)}else R=/^[a-z]+$/i.test(j[2])?t(j[2]):parseInt(j[2]);w>=f.OP.JUMP&&w<=f.OP.JNGRE&&(R=O,O=0,k=0);var x=n(w,O,k,E,R);o.push(x)}}catch(e){l=!0,h=e}finally{try{!c&&b.return&&b.return()}finally{if(l)throw h}}return{code:o,data:i.data,debugData:{symbols:Object.freeze(i.symbols),sourceMap:Object.freeze(i.sourceMap)}}};t.exports=d},{"./ttk91js.common.js":6,"./ttk91js.debugger.js":8,"./ttk91js.exceptions.js":9}],8:[function(e,t,r){function n(e){this.PC=0,this.IR=0,this.symbols=Object.freeze(e.symbols),this.sourceMap=Object.freeze(e.sourceMap)}var i=(e("./ttk91js.exceptions.js").Ttk91jsCompileException,e("./ttk91js.exceptions.js").Ttk91jsRuntimeException);n.prototype={cycle:function(e,t){this.PC=e,this.IR=t},cycleEnd:function(e){this.PC=e},getCurrentLineNumber:function(){return this.getLineNumber(this.PC)},getLineNumber:function(e){return e instanceof i?this.getLineNumber(this.PC):e<0||e>=this.sourceMap.length?null:this.sourceMap[e]}},t.exports=n},{"./ttk91js.exceptions.js":9}],9:[function(e,t,r){function n(e){this.name="Ttk91jsRuntimeException",this.message=e}function i(e,t){this.name="Ttk91jsCompileException",this.message=e,this.line=t}n.prototype.toString=function(){return this.name+": "+this.message},i.prototype.toString=function(){return this.name+": "+this.message},t.exports={Ttk91jsCompileException:i,Ttk91jsRuntimeException:n}},{}],10:[function(e,t,r){function n(e){var t=s.splitWord(e),r=_slicedToArray(t,5),n=r[0],o=r[1],u=r[2],a=r[3],f=r[4];if(0===n)return"NOP";var l="";switch(u){case s.MODE.IMMEDIATE:l="=";break;case s.MODE.INDIRECT:l="@"}if(n>=s.OP.JUMP&&n<=s.OP.JNGRE)return i.format("%s %d",c[n],f);var h="R"+o;return 6==o?h="SP":7==o&&(h="FP"),i.format("%s %s, %s%s(R%s)",c[n],h,l,f,a)}var i=e("util"),s=e("./ttk91js.common.js"),o=e("./ttk91js.compile.js"),u=e("./ttk91js.machine.js"),c=(Object.keys(s.OP),{});for(var a in s.OP)c[s.OP[a]]=a;var f={word:function(e){var t=("0".repeat(32)+(e>>>0).toString(2)).slice(-32);console.log(t.substr(0,8)+" "+t.substr(8,3)+" "+t.substr(11,2)+" "+t.substr(13,3)+" "+t.substr(16))},bin:function(e){console.log(("0".repeat(32)+(e>>>0).toString(2)).slice(-32))}},l={wordToSymbolic:n,compile:o,createMachine:function(e){return new u(e)},debug:f};"undefined"==typeof window?t.exports=l:window.ttk91js=l},{"./ttk91js.common.js":6,"./ttk91js.compile.js":7,"./ttk91js.machine.js":11,util:5}],11:[function(e,t,r){(function(r){function n(e){this.settings=e,this.memory=Object.freeze(new c(this,e.memory||512)),this.registers=new u(this),this.stdout={write:function(e){r.stdout.write(e+"\n")}},this.reset()}var i=e("microevent"),s=e("./ttk91js.common.js"),o=e("./ttk91js.exceptions.js").Ttk91jsRuntimeException,u=e("./ttk91js.registers.js"),c=e("./ttk91js.memory.js"),a=e("./ttk91js.debugger.js"),f={CRT:0},l={HALT:11},h=s.OP,p=s.SR_BITS,g=8;n.prototype={getDebugger:function(){return this.debugger},reset:function(){this.ok=!0,this.SR=0,this.registers.reset(),this.memory.reset(),this.debugger=null},load:function(e){for(var t=0;t<e.code.length;t++)this.memory.setAt(t,e.code[t]);for(var r=0,n=0;n<e.data.length;n++)this.memory.setAt(t+r,e.data[n].value),r+=e.data[n].size;this.debugger=new a(e.debugData)},getRegisters:function(){return this.registers},getMemory:function(){return this.memory},stop:function(){this.ok=!1},setStdout:function(e){this.stdout=e},run:function(e){e=e||-1;for(var t=0;this.isRunning()&&(this.runWord(),t++,!(e>0&&t>=e)););},isRunning:function(){return this.ok&&this.registers.get(g)<this.memory.size()},runWord:function(e){e=e||1;for(var t=0;t<e;t++)this._runWord()},_getValue:function(e,t,r){var n=0;if(n=0===t?r:this.registers.get(t)+r,e>=3)throw new o("Invalid memory access mode");return e>0&&(n=this._getValue(--e,t,this.memory.getAt(r))),n},_runWord:function(){var e=this.memory.getAt(this.registers.get(g));this.debugger.cycle(this.registers.get(g),e);var t=s.splitWord(e),r=_slicedToArray(t,5),n=r[0],i=r[1],u=r[2],c=r[3],a=r[4],y=this._getValue(u,c,a);switch(this.registers.add(g,1),n){case h.NOP:break;case h.STORE:this.memory.setAt(y,this.registers.get(i));break;case h.LOAD:this.registers.set(i,y);break;case h.OUT:switch(a){case f.CRT:this.stdout.write(this.registers.get(i))}break;case h.ADD:this.registers.add(i,y);break;case h.SUB:this.registers.add(i,-y);break;case h.DIV:this.registers.set(i,Math.floor(this.registers.get(i)/y));break;case h.MUL:this.registers.set(i,this.registers.get(i)*y);break;case h.MOD:this.registers.set(i,this.registers.get(i)%y);break;case h.AND:this.registers.set(i,this.registers.get(i)&y);break;case h.OR:this.registers.set(i,this.registers.get(i)|y);break;case h.XOR:this.registers.set(i,this.registers.get(i)^y);break;case h.SHL:this.registers.set(i,this.registers.get(i)<<y);break;case h.SHR:this.registers.set(i,this.registers.get(i)>>y);break;case h.SHRA:this.registers.set(i,this.registers.get(i)>>>y);break;case h.NOT:this.registers.set(i,~this.registers.get(i));break;case h.SVC:switch(a){case l.HALT:this.ok=!1,this.trigger("halt")}break;case h.COMP:this.SR=0;var m=this.registers.get(i);m==y&&(this.SR|=p.E),m>y&&(this.SR|=p.G),m<y&&(this.SR|=p.L);break;case h.JUMP:this.registers.set(g,a);break;case h.JNEG:break;case h.JZER:break;case h.JPOS:break;case h.JNNEG:break;case h.JNZER:break;case h.JNPOS:break;case h.JLES:break;case h.JEQU:this.SR&p.E&&this.registers.set(g,this.memory.getAt(a));break;case h.JGRE:break;case h.JNLES:break;case h.JNEQU:this.SR&p.E||this.registers.set(g,this.memory.getAt(a));break;case h.JNGRE:break;default:throw new o("unknown opcode ("+n+")")}this.debugger.cycleEnd(this.registers.get(g))}},i.mixin(n),t.exports=n}).call(this,e("_process"))},{"./ttk91js.common.js":6,"./ttk91js.debugger.js":8,"./ttk91js.exceptions.js":9,"./ttk91js.memory.js":12,"./ttk91js.registers.js":13,_process:2,microevent:1}],12:[function(e,t,r){function n(e,t){this.machine=e,this.memory=new Uint32Array(t)}var i=e("./ttk91js.exceptions.js").Ttk91jsRuntimeException;n.prototype={setAt:function(e,t){if(e<0||e>=this.memory.length)throw new i("trying to access outside of program memory ("+e+")");this.machine.settings.triggerMemoryWrite&&this.machine.trigger("memory-write",e,this.memory[e],t),this.memory[e]=t},getAt:function(e){if(e<0||e>=this.memory.length)throw new i("trying to access outside of program memory ("+e+")");return this.memory[e]},getAll:function(){return this.memory},reset:function(){this.memory.fill(0)},size:function(){return this.memory.length}},t.exports=n},{"./ttk91js.exceptions.js":9}],13:[function(e,t,r){function n(e){this.machine=e,this.reg=new Uint32Array(9)}var i=e("./ttk91js.exceptions.js").Ttk91jsRuntimeException;n.prototype={set:function(e,t){if(e<0||e>=this.reg.length)throw new i("trying to access invalid register ("+e+")");this.machine.settings.triggerRegisterWrite&&this.machine.trigger("register-write",e,this.reg[e],t),this.reg[e]=t},get:function(e){if(e<0||e>=this.reg.length)throw new i("trying to access invalid register ("+e+")");return this.reg[e]},add:function(e,t){this.set(e,this.reg[e]+t)},getAll:function(){return this.reg},reset:function(){this.reg.fill(0)}},t.exports=n},{"./ttk91js.exceptions.js":9}]},{},[10]);